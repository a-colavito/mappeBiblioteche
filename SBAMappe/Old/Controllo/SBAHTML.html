<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <title>Mappe Biblioteche</title>

    <!-- CSS Personalizzato -->
    <link rel="stylesheet" href="test.css" type="text/css">

    <!-- Importazione CSS Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <!-- Importazione Javascript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="poliJson.js"></script>
    <script src="../../Dataset/Edifici.js"></script>
    <script src="../../Dataset/Percorsi.js"></script>
</head>

<body>
<!-- Mappa Polilibrary -->
<h1>MAPPA POLILIBRARY</h1>
<div id="mapPoliLibrary" style="height: 400px; box-sizing: border-box"></div>

<script>
    let mapPoliLibrary = L.map('mapPoliLibrary').setView([41.108835, 16.878363], 17);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 20
    }).addTo(mapPoliLibrary);

    mapPoliLibrary.flyTo([41.108871833781194, 16.878381940222113], 19);

    const filtroPoliLibrary = Percorsi.features.filter(feature => feature.properties.name.includes("Polilibrary"));

    // Aggiungi un flag per distinguere la mappa Polilibrary
    const mapContext = 'Polilibrary';

    // Mappa Polilibrary
    L.geoJSON(filtroPoliLibrary, {
        onEachFeature: (feature, layer) => layer.bindPopup(feature.properties.name),
        style: (feature) => getStyle(feature, mapContext),
        pointToLayer: (feature, latlng) => L.circleMarker(latlng, {
            radius: 5,
            fillColor: getPointColor(feature),
            color: getOutlineColor(feature),
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
        })
    }).addTo(mapPoliLibrary);

    function getStyle(feature, mapContext) {
        const style = { weight: 4 };
        switch (feature.properties.name) {
            case "Percorso Orabona Polilibrary/Brucoli":
                style.color = mapContext === 'Polilibrary' ? 'red' : 'blue';
                style.dashArray = '8,8';
                break;
            case "Percorso Polilibrary via Re David":
            case "Percorso Vitruvius via Re David":
                style.color = 'blue';
                style.dashArray = '8,8';
                break;
            case "semi-Percorso Orabona - Polilibrary - Vitruvius - Brucoli":
            case "Percorso Orabona Brucoli/Polilibrary":
            case "semi-Percorso Vitruvius Orabona":
                style.color = 'red';
                style.dashArray = '8,8';
                break;
            default:
                style.color = '#3b8794';
                style.fillOpacity = '0.3';
                style.opacity = '0.5';
                break;
        }
        return style;
    }

    function getPointColor(feature) {
        switch (feature.properties.name) {
            case "Biblioteca Polilibrary":
                return '#d43c41'; // Rosso
            case "Biblioteca Vitruvius":
                return '#6293ce'; // Blu
            default:
                return '#3b8794'; // Verde
        }
    }

    function getOutlineColor(feature) {
        switch (feature.properties.name) {
            case "Biblioteca Polilibrary":
                return '#e04a4c'; // Colore rosso per il contorno
            case "Biblioteca Vitruvius":
                return '#3498db'; // Colore blu per il contorno
            default:
                return '#3b8794'; // Colore verde per il contorno
        }
    }

    L.marker([41.10887, 16.87838]).addTo(mapPoliLibrary)
        .bindPopup('<strong>Corpo a Z 3° piano </strong> <br>' +
            'Front-office: tel. 0805963005 - 3006\n<br>' +
            '<a href="mailto: polilibrary@poliba.it">polilibrary@poliba.it</a>')
        .openPopup();
</script>

<!-- Mappa Brucoli -->
<h1>MAPPA BRUCOLI</h1>
<div id="mapBrucoli" style="height: 400px;"></div>

<script>
    let mapBrucoli = L.map('mapBrucoli').setView([41.108900, 16.879061], 17);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 20
    }).addTo(mapBrucoli);

    mapBrucoli.flyTo([41.10887, 16.87838], 19);

    const filtroBrucoli = Percorsi.features.filter(feature =>
        feature.properties.name.includes("Brucoli") || feature.properties.name.includes("Percorso Polilibrary via Re David") || feature.properties.name.includes("Percorso Orabona Brucoli/Polilibrary")
    );

    // Aggiungi un flag per distinguere la mappa Brucoli
    const mapContextBrucoli = 'Brucoli';

    // Mappa Brucoli
    L.geoJSON(filtroBrucoli, {
        onEachFeature: (feature, layer) => layer.bindPopup(feature.properties.name),
        style: (feature) => getStyle(feature, mapContextBrucoli),
        pointToLayer: (feature, latlng) => L.circleMarker(latlng, {
            radius: 8,
            fillColor: getPointColor(feature),
            color: "#000",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
        })
    }).addTo(mapBrucoli);

    L.marker([41.10891, 16.87906]).addTo(mapBrucoli)
        .bindPopup('<strong>Palazzo adiacente atrio “Cherubini”, 2° piano</strong> <br>' +
            'Front-office: tel. 0805963029<br>' +
            '<a href="mailto: biblio.ing@poliba.it">biblio.ing@poliba.it</a>')
        .openPopup();
    mapBrucoli.flyTo([41.108900, 16.879056], 19);
</script>

<!-- Mappa Vitruvius -->
<h1>MAPPA VITRUVIUS</h1>
<div id="mapVitruvius" style="height: 400px;"></div>

<script>
    let mapVitruvius = L.map('mapVitruvius').setView([41.109462, 16.878825], 17);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 20
    }).addTo(mapVitruvius);

    mapVitruvius.flyTo([41.10951, 16.87881], 19);

    const filtroVitruvius = Percorsi.features.filter(feature => feature.properties.name.includes("Vitruvius"));

    // Mappa Vitruvius
    L.geoJSON(filtroVitruvius, {
        onEachFeature: (feature, layer) => layer.bindPopup(feature.properties.name),
        style: (feature) => getStyle(feature, 'Vitruvius'),
        pointToLayer: (feature, latlng) => L.circleMarker(latlng, {
            radius: 8,
            fillColor: getPointColor(feature),
            color: "#000",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
        })
    }).addTo(mapVitruvius);

    L.marker([41.10951, 16.87881]).addTo(mapVitruvius)
        .bindPopup('<strong>Palazzo Architettura, piano terra</strong> <br>' +
            'Front-office: tel. 0805963578<br>' +
            '<a href="mailto: biblio.architettura@poliba.it">biblio.architettura@poliba.it</a>')
        .openPopup();
</script>

</body>

</html>
